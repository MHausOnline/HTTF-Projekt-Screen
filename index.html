<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Grenzenlose Ger√§tkommunikation</title>
    <style>
        button {
            border: none;
            border-radius: 20px;
            background-color: black;
            color: white;
            font-size: 30pt;
            margin-bottom: 10vh !important;
            margin-top: 10vh !important;
        }
        

        .container {
            padding-top:30px;
            margin: auto;
            width: 50%;
        }

        .container > * {
            margin-bottom: auto;
            margin-left: 25%;
            margin-right: 25%;
            margin-top: auto;
            width: 50%;
        }

        #adminContainer, #clientContainer, #relativePosContainer {
            display:none;
        }

        #relativePosContainer {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100vw;
            height: 100vh;
            margin: 0px;
            pointer-events: none;
        }

        #relativePosContainer > *{
            position: absolute;
            font-size: 20pt;
            pointer-events: all;
        }

        #relativePosContainer > #leftArrow {
            left:0px;
            top:50%;
        }

        #relativePosContainer > #rightArrow {
            right:0px;
            top:50%;
        }

        #relativePosContainer > #topArrow {
            top:0px;
            right:50%;
        }

        #relativePosContainer > #bottomArrow {
            bottom:0px;
            right:50%;
        }

    </style>
</head>
<body>
    <span id="relativePosContainer">
        <span id="leftArrow">
            &#x2190;
        </span>
        <span id="topArrow">
            &#x2191;
        </span>
        <span id="rightArrow">
            &#x2192;
        </span>
        <span id="bottomArrow">
            &#x2193;
        </span>
    </span>

    <div id="chooseContainer" class="container">
        <button id="roleAdmin">Host a session</button><br>
        <button id="roleClient">Join a session</button>
    </div>
    
    <div id="adminContainer" class="container">
        <h1>Hosting a Session</h1>
        <form id="urlSubmit">
            <label for="url">Enter your desired URL:</label><br>
            <input id="url" name="url" type="text">
        </form>
        <br><br>
        <span>Your rooms name is: <span id="roomName"></span></span>
    </div>

    <div id="clientContainer" class="container">
        <h1>Joining a Session</h1>
        <form id="sessionSubmit">
            <label for="roomId">Enter the Session's name:</label><br>
            <input id="roomId" name="roomId" type="text">
        </form>
        
    </div>

    <script type="importmap">
    {
        "imports": {
        "socket.io-client": "https://cdn.socket.io/4.8.1/socket.io.esm.min.js"
        }
    }
    </script>

    <script type="module">
    import { io } from "socket.io-client";

    const socket = io();
    var current_room;
    var user_role;

    document.getElementById("roleAdmin").addEventListener("click",(event)=>{
        socket.emit("set_role",{"role":"admin"})
        user_role = "admin";
        console.log("role admin")
        hideInitialSelect();
        selectAdmin();
    })

    document.getElementById("roleClient").addEventListener("click",(event)=>{
        socket.emit("set_role",{"role":"client"})
        user_role = "client";
        console.log("role client")
        hideInitialSelect()
        selectClient()
    })

    socket.on("joined_room",(data)=>{
        console.log("joining room",data.room,"successfull")
        document.getElementById("roomName").innerText = data.room;
    })

    function hideInitialSelect(){
        document.getElementById("chooseContainer").style.display = "none";
    }

    function showPosGrid(){
        document.getElementById("relativePosContainer").style.display = "block";

        document.getElementById("leftArrow").addEventListener('click',(event) => {
            socket.emit("arrow_pressed",{"dir":"left"})
        })
        document.getElementById("rightArrow").addEventListener('click',(event) => {
            socket.emit("arrow_pressed",{"dir":"right"})
        })
        document.getElementById("topArrow").addEventListener('click',(event) => {
            socket.emit("arrow_pressed",{"dir":"top"})
        })
        document.getElementById("bottomArrow").addEventListener('click',(event) => {
            socket.emit("arrow_pressed",{"dir":"bottom"})
        })

    }

    function selectClient(){
        document.getElementById("clientContainer").style.display = "block";
        document.getElementById("sessionSubmit").addEventListener("submit", (event) => {
            console.log("room sent")
            socket.emit("join_room",{"room":document.getElementById("roomId").value})
            event.preventDefault();

            showPosGrid()
        });

    }

    function selectAdmin(){
        document.getElementById("adminContainer").style.display = "block";
        document.getElementById("roomName").innerText = "loading...";

        document.getElementById("urlSubmit").addEventListener("submit", (event) => {
            console.log("url sent")
            location.href = "https://"+document.getElementById("url").value.replaceAll("http:","").replaceAll("https:","")
            event.preventDefault();
        });

        
    }
    </script>
</body>
</html>